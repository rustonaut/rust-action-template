name: On PR rust related checks.
on:
  pull_request:
    type: [opened, reopened, synchronize]

jobs:
  style:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Check cargo fmt
        run: cargo fmt -- --check
      - name: Check clippy
        run: cargo clippy

  functionality:
    runs-on: ubuntu-latest
    strategy:
      rust_version: [ "stable", "beta" ]
      features: [ "", "default", "*" ]
    steps:
      - uses: actions/checkout@v1

      - uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: ${{ matrix.rust_version }}

      - name: Check build
        uses: .github/actions/run-cargo
        with:
          cmd: build
          features: ${{ matrix.features }}
          verbose: true
          deny_warnings: true

      - name: Run tests
        uses: .github/actions/run-cargo
        with:
          cmd: test
          features: ${{ matrix.features }}
          verbose: true
          deny_warnings: true